name: Update version

on:
  push:
    branches:
      - main

jobs:
  update-version:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 16

    - name: Update version
      run: |
        npm version ${{ github.event.inputs.new_version }} --message "[skip ci] Bump version to ${{ github.event.inputs.new_version }}"

      env:
        NEW_VERSION: ${{ github.event.inputs.new_version }}

    - name: Commit and push
      run: |
        if git diff --quiet; then
          touch .bump-version-file
          git add .bump-version-file
        fi
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git commit -m "[skip ci] Bump version to ${{ github.event.inputs.new_version }}"
        git push "git@github.com:${{ github.repository }}.git"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
